# GrouMap（ぐるまっぷ）サービス機能一覧

> **最終更新**: 2026-02-20（新規登録フロー簡略化・プロフィール完成度カード追加・デフォルト表示名/ユーザーID自動設定）
>
> 本ドキュメントは、ユーザー用アプリ (`groumapapp`) と店舗用アプリ (`groumapapp_store`) の全Dartファイルおよび関連ドキュメントを基に、サービスの全機能をまとめたものです。

---

## サービス概要

**GrouMap（ぐるまっぷ）** は、中小飲食店向けのスタンプ＋マップ＋発見型プラットフォームアプリです。

- **キャッチフレーズ**: 小さなお店が見つかる地図
- **対象**: BtoB（飲食店オーナー向け）＋ BtoC（一般ユーザー向け）
- **技術スタック**: Flutter (Dart) + Firebase (Auth/Firestore/Functions/Storage/FCM) + Google Maps
- **対応プラットフォーム**: iOS / Android

> コアコンセプト・ビジネス方針・競合比較・収益モデル・KPI定義については [BUSINESS_MODEL.md](BUSINESS_MODEL.md) を参照

---

## 1. ユーザー向け機能（BtoC）

### 1.1 認証・アカウント管理

| 機能 | 説明 |
|------|------|
| **メール/パスワード認証** | メールアドレスとパスワードによるログイン・新規登録 |
| **Googleサインイン** | Googleアカウントでのソーシャルログイン |
| **Appleサインイン** | Apple IDでのソーシャルログイン |
| **メールOTP認証** | Cloud Functions経由の6桁コードによるメール認証（登録時必須） |
| **パスワードリセット** | メールアドレスを入力してパスワード再設定メールを送信 |
| **プロフィール設定（初回登録）** | 新規登録時は生年月日・性別のみ入力（メール/Apple登録時はユーザー名も）。表示名は「ユーザー」、ユーザーIDは「user_」+UID先頭8文字がデフォルトで自動設定。都道府県・市区町村・職業・自己紹介・興味カテゴリ・プロフィール画像は後からプロフィール編集で入力可能 |
| **プロフィール完成度カード** | アカウント設定画面に表示（完成度100%未満の場合のみ）。9項目（表示名・生年月日・性別・都道府県・市区町村・職業・自己紹介・興味カテゴリ・プロフィール画像）ベースのプログレスバーで完成度を可視化し、段階的なプロフィール入力を促す。プロフィール未完成時は設定リストの「プロフィール編集」メニューを非表示化し、完成度カードからのみ編集画面へ遷移 |
| **プロフィール編集** | 登録済み情報の変更、ユーザーID（ユニーク制約・英数字+アンダースコア・3〜20文字）、自己紹介（最大100文字）、職業（8種選択）、興味のあるカテゴリ（46カテゴリから複数選択）、アイコン画像のトリミング・アップロード |
| **パスワード変更** | 現在のパスワードを確認した上で新パスワードに変更 |
| **アカウント削除（退会）** | サブコレクション・プロフィール画像を含む完全削除 |
| **利用規約・プライバシーポリシー同意** | 登録前の規約同意画面 |
| **ゲストモード** | ログインなしでもホーム・マップ・投稿の閲覧が可能（スロットキャンペーンボタン・ミッションフローティングボタンは非表示） |

### 1.2 ホーム画面

| 機能 | 説明 |
|------|------|
| **おすすめ店舗カード** | 現在地に近い未訪問の店舗をレコメンド表示 |
| **ニュースセクション** | 掲載期間内のニュースを画像のみ1:1横スクロールで最大7件表示 |
| **特別クーポンセクション** | コイン交換で獲得した100円引きクーポンを黄色テーマの横スクロールカードで表示（1枚以上保有時のみ・枚数バッジ付き・タップでクーポン詳細へ遷移） |
| **クーポンセクション** | 利用可能なクーポンの一覧へのショートカット |
| **投稿セクション** | Instagram投稿と通常投稿を日付順で混合プレビュー表示。投稿カードはタイトル非表示・テキスト2行表示。Instagram投稿は「Instagram」バッジ（ピンク）、通常投稿は店舗ジャンルバッジ（オレンジ）を表示 |
| **デイリーレコメンド** | その日初めてのアプリ起動時に未訪問のおすすめ店舗を自動表示 |
| **統計カプセルバー** | コイン・バッジ・スタンプの現在数をメニュー上部にカプセル形式で横並び表示（全てFirestoreリアルタイム取得、未ログイン時は `-` 表示） |
| **スロットキャンペーンボタン** | ログインユーザーのみ、キャンペーン期間中かつ当日未プレイ時のみメニュー下にカプセル型画像バナーボタンを表示、プレイ済みの日は非表示、タップでスロット画面へ遷移 |
| **ミッションフローティングボタン** | ログインユーザーのみ表示。受取可能なミッション（達成済み＆未受取）がある場合はティール〜グリーングラデーション、ない場合はグレーアウト表示。ミッション画面から戻った時に状態を再判定 |
| **各機能への導線** | 店舗一覧・クーポン・スタンプカード・バッジ・ランキング・紹介等へのメニュー |

### 1.3 マップ機能

| 機能 | 説明 |
|------|------|
| **Google Maps表示** | 現在地周辺の登録店舗をマーカーで地図上に表示 |
| **店舗マーカー** | 未訪問/開拓中/常連の状態を色分けで表示 |
| **店舗検索** | テキスト検索で店舗を絞り込み |
| **店舗情報パネル** | マーカータップで店舗の基本情報をパネル表示 |
| **現在地ボタン** | 現在位置に地図を移動 |
| **北向き整列** | ワンタップで地図を北向きに揃える |
| **フィルター設定** | 以下の条件で店舗をフィルタリング（設定はFirestoreに保存） |

#### マップフィルター詳細

| フィルター項目 | 選択肢 |
|--------------|--------|
| **営業状況** | 営業中のみ表示（ON/OFF） |
| **ジャンル** | カフェ・喫茶店、レストラン、居酒屋、和食、日本料理、海鮮、寿司、そば、うどん、うなぎ、焼き鳥、とんかつ、串揚げ、天ぷら、お好み焼き、もんじゃ焼き、しゃぶしゃぶ、鍋、焼肉、ホルモン、ラーメン、中華料理、餃子、韓国料理、タイ料理、カレー、洋食、フレンチ、スペイン料理、ビストロ、パスタ、ピザ、ステーキ、ハンバーグ、ハンバーガー、ビュッフェ、食堂、パン・サンドイッチ、スイーツ、ケーキ、タピオカ、バー・お酒、スナック、料理旅館、沖縄料理、その他（複数選択可） |
| **開拓状態** | 未開拓 / 開拓中 / 常連（複数選択可） |
| **お気に入り** | お気に入りのみ表示（ON/OFF） |
| **決済方法** | 現金 / クレジットカード / 電子マネー / QR決済（複数選択可） |
| **クーポン** | クーポンあり / 利用可能クーポンあり（ON/OFF） |
| **距離** | 制限なし / 500m以内 / 1km以内 / 3km以内 / 5km以内 / 10km以内 |

### 1.4 店舗詳細

| 機能 | 説明 |
|------|------|
| **トップタブ** | 店舗名・アイコン・説明文、利用可能クーポン一覧、投稿プレビュー（新着15件・3列グリッド） |
| **店内タブ** | 店内画像のギャラリー表示 |
| **メニュータブ** | カテゴリ別フィルタ（コース/料理/ドリンク/デザート）でメニュー一覧を表示（画像・価格付き） |
| **投稿タブ** | Instagram投稿と通常投稿を混合表示（動画除外・最大51件・日付降順） |
| **お気に入り操作** | 店舗をお気に入りに追加/解除 |
| **スタンプ状況** | 現在のスタンプ数と達成状況の確認 |
| **決済方法表示** | 対応している決済方法をカテゴリ別にChip表示（現金/カード/電子マネー/QR決済） |
| **座席数** | テキストで座席情報を表示 |
| **設備・サービス情報** | アクセス情報、駐車場/テイクアウト/喫煙/Wi-Fi/バリアフリー/子連れ/ペットの対応状況をChip表示（利用可能=オレンジ/不可=グレー） |

### 1.5 QRコード機能

| 機能 | 説明 |
|------|------|
| **QR表示** | JWTベースのQRトークンを生成・表示（60秒有効、55秒+ジッターで自動更新、残り秒数カウントダウン表示）。画面表示時に輝度をMAXに自動設定し、他画面遷移時に元の輝度に復元 |
| **スタンプ押印申請** | QR読み取り後に店舗へスタンプ押印を申請 |
| **スタンプ押印確認** | 店舗側の押印結果を確認 |
| **チェックイン承認** | 店舗側入力後のユーザー承認操作 |

### 1.6 スタンプ

| 機能 | 説明 |
|------|------|
| **スタンプカード一覧** | ユーザーが持つ各店舗のスタンプカードを一覧表示 |
| **スタンプ獲得** | 来店時のQRチェックインでスタンプを獲得 |
| **スタンプカード2枚目以降** | 同一店舗で10個達成後も2枚目以降を発行可能 |
| **10スタンプ達成特典** | スタンプ10個達成時の特典（内容は店舗裁量で任意設定） |
| **常連向けクーポン** | 店舗が任意で設定可能（最大3枚、0枚も可） |
| **スタンプ履歴** | 全て/獲得履歴のタブで時系列表示 |
| **取引履歴** | クーポン利用履歴とスタンプ受取導線を表示 |
| **スタンプ押印申請** | 手動でスタンプ押印を店舗に申請 |
| **付与結果画面** | スタンプ獲得演出、使用/未使用クーポンのリスト表示 |

### 1.7 クーポン

| 機能 | 説明 |
|------|------|
| **クーポン一覧** | 利用可能/使用済みのタブ切替で表示 |
| **クーポン詳細** | ヘッダー画像、概要、期限、割引情報、必要スタンプ数、店舗情報、注意事項を表示。画面下部に固定の「使用する」ボタンを配置 |
| **クーポン取得** | 条件を満たしたクーポンを自動的に取得（重複チェック付き） |
| **クーポン直接使用** | クーポン詳細画面の「使用する」ボタンからクーポンを直接使用（確認ダイアログ付き、Firestoreトランザクションで5コレクションを一括更新）。使用済み/有効期限切れ/配布終了/スタンプ不足/未ログイン時はボタン無効化。コイン交換クーポン（type=coin_exchange）の場合はuser_couponsを直接更新する専用フローで処理 |
| **クーポン使用（店舗フロー）** | 店舗用アプリのスタンプ押印フロー内でクーポンを選択して使用（トランザクション処理） |
| **クーポンタイプ** | 割引 / 無料 / 値引き / キャッシュバック |

### 1.8 バッジ・ゲーミフィケーション

| 機能 | 説明 |
|------|------|
| **バッジ一覧** | ヘッダー右上フィルターでカテゴリ絞り込み可能なバッジグリッド表示（アプリ内蔵データ、Firestore不使用） |
| **バッジ獲得演出** | バッジ獲得時のアニメーション演出画面（ホーム画面表示2秒後にポップアップ。レコメンドポップアップとの競合時はレコメンド優先→閉じた後2秒でバッジ表示） |
| **バッジ進捗管理** | 各バッジの達成条件に対する進捗を表示 |
| **自動バッジ付与** | 条件達成時にバッジを自動的に付与（重複防止）。アクション系バッジは各アクション実行時に即座に判定・付与。スタンプ/来店/連続ログイン等は日次包括チェックで判定 |
| **バッジレア度** | Common / Rare / Epic / Legendary の4段階 |
| **バッジ定義** | アプリ内蔵（全141個）。既存タイプ: スタンプ総数(15段階) / 来店回数 / 連続日数 / 訪問店舗数 / 特別イベント。カテゴリ別来店(10グループ×5段階=50個)。アクション系: マップ閲覧 / 店舗詳細閲覧 / プロフィール完成 / お気に入り登録 / スロット / スロット当選 / クーポン使用 / いいね / コメント / フォロー / コイン獲得 / ミッション達成 / レコメンド閲覧 / スタンプカード達成。詳細は [BADGE_LIST.md](BADGE_LIST.md) 参照 |

### 1.9 ランキング

| 機能 | 説明 |
|------|------|
| **ランキング表示** | ユーザーランキングを一覧表示 |
| **ランキング種別** | コイン数 / バッジ数 / スタンプ数 / 支払い額 で切替 |
| **期間フィルター** | 日次 / 週次 / 月次 / 全期間 で絞り込み |
| **自分の順位確認** | ランキング内での自分の位置を確認 |
| **ランキング履歴** | 過去のランキング期間の成績を確認 |

### 1.10 投稿・ソーシャル

| 機能 | 説明 |
|------|------|
| **投稿一覧（統一フィード）** | Instagram投稿と通常投稿を日付順で混合表示。3列グリッド（画像なし投稿は除外・51件ずつボタン式追加読込「さらに表示する」・最大306件・1店舗あたり最大51件） |
| **投稿詳細** | 画像カルーセル、店舗アイコン+店舗名+投稿日付、タイトル/本文、Instagram投稿時は「Instagramを開く」リンクボタン（元投稿に遷移）、いいね、コメント一覧/入力（Instagram投稿・通常投稿の両方で利用可能） |
| **いいね** | 投稿へのいいね追加/解除（Instagram投稿含む全投稿対応） |
| **コメント** | 投稿へのコメント投稿・一覧表示（Instagram投稿含む全投稿対応） |
| **フォロー** | 他ユーザーのフォロー/フォロー解除 |
| **フィード** | フォロー中ユーザーの投稿をフィードで表示 |

### 1.11 通知・お知らせ

| 機能 | 説明 |
|------|------|
| **通知一覧** | お知らせ/通知のタブ切替で表示 |
| **通知詳細** | 種別バッジ、日時、タイトル、本文、画像、タグの詳細表示 |
| **お知らせ詳細** | カテゴリ/優先度バッジ、タイトル、公開日時、本文の表示 |
| **未読管理** | 未読通知数の表示、個別/一括既読化 |
| **通知種別** | ランキング / バッジ獲得 / レベルアップ / コイン獲得 / ソーシャル / マーケティング / システム |
| **プッシュ通知** | FCMによるプッシュ通知受信 |
| **通知設定（統合）** | プッシュ通知・メール通知の項目ごとのON/OFF切替を1画面で管理 |
| **ニュース詳細** | ニュース画像(1:1)、タイトル、掲載期間、本文の表示 |

### 1.12 紹介機能

| 機能 | 説明 |
|------|------|
| **友達紹介（当面停止）** | 友達紹介キャンペーンは当面実施しない |
| **店舗紹介（検討中）** | 店舗紹介キャンペーンは必要時に別途検討 |
| **紹介特典（未提供）** | 現時点では紹介特典の付与は実施しない |

### 1.13 店舗一覧

| 機能 | 説明 |
|------|------|
| **お気に入り/全店舗タブ** | お気に入り店舗と全店舗の切替表示 |
| **店舗カードリスト** | 店舗の基本情報をカード形式で一覧表示 |
| **店舗詳細への遷移** | カードタップで店舗詳細画面へ遷移 |

### 1.14 フィードバック

| 機能 | 説明 |
|------|------|
| **フィードバック送信** | カテゴリ選択、件名/本文/メール入力で運営へフィードバックを送信 |

### 1.15 サポート

| 機能 | 説明 |
|------|------|
| **ヘルプ画面** | FAQ、問い合わせ導線、アプリ情報 |
| **メールサポート** | お問い合わせフォームでカテゴリ選択・メール送信 |
| **電話サポート** | 電話番号・営業時間・対応内容の案内 |
| **ライブチャット** | リアルタイムのチャットサポート |
| **連絡先一覧** | 電話/メール/住所のタップで起動 |

### 1.16 法務・規約

| 機能 | 説明 |
|------|------|
| **利用規約** | アプリ内での利用規約表示 |
| **プライバシーポリシー** | アプリ内でのプライバシーポリシー表示 |

### 1.17 アプリ基盤機能

| 機能 | 説明 |
|------|------|
| **アプリ更新チェック** | 最低バージョン未満で強制更新画面、最新版未満で任意更新ダイアログ |
| **メンテナンスモード** | 設定された期間中はメンテナンス画面を表示 |
| **位置情報サービス** | 現在位置取得、権限管理、距離計算、位置変更の監視 |

### 1.18 コインシステム

> コインはアプリ利用で貯まるプラットフォーム独自の通貨。スタンプ（来店の証）とは完全に別物として設計。

| 機能 | 説明 |
|------|------|
| **デイリーミッション** | 毎日リセットされる3種のミッション（アプリを開く・レコメンドを見る・マップを開く）、各+1コイン、1日上限3コイン |
| **連続ログインボーナス** | 3日連続+2 / 7日連続+5 / 30日連続+10コイン |
| **新規登録ミッション** | 初回限定の5種ミッション（プロフィール完成・マップ初利用・お気に入り登録・店舗詳細閲覧・スロット初挑戦）、合計最大15コイン |
| **来店ボーナス** | 来店（スタンプ獲得）時に+1コイン |
| **スロット** | 1コイン/回・1日1回（開始時に確認ポップアップ表示）。1等(1%)=コイン×20 / 2等(5%)=コイン×10 / ハズレ(94%)=コイン×0（消費分のみ） |
| **未訪問店舗クーポン取得** | コイン10枚で未訪問店舗限定100円引きクーポン1枚を取得（スタンプは付与されない） |
| **コイン残高確認** | 現在のコイン残高の表示 |
| **コイン有効期限** | 最終獲得日から180日 |

---

## 2. 店舗オーナー向け機能（BtoB）

### 2.1 認証・店舗登録

| 機能 | 説明 |
|------|------|
| **メール/パスワード認証** | 店舗用アカウントのログイン・新規登録 |
| **メールOTP認証** | Cloud Functions経由の6桁コードによるメール認証 |
| **パスワードリセット** | パスワード再設定メールの送信 |
| **店舗情報入力** | 店舗名、経営形態（個人/法人）、法人名/代表者名、住所、カテゴリ、営業時間、タグ、画像、設備・サービス情報の入力 |
| **店舗位置選択** | マップ上で店舗の所在地をピン指定 |
| **承認待ち画面** | 店舗登録後の運営による承認待ち状態の表示 |
| **アカウント削除申請** | ヘルプ・サポートのFAQから削除申請を送信し、管理者が承認すると店舗を無効化（isActive=false）。実際のアカウント削除は行わない |

### 2.2 ホーム（ダッシュボード）

| 機能 | 説明 |
|------|------|
| **今日のサマリー** | 来店者数・付与スタンプ数・新規顧客数・クーポン利用数の即時確認 |
| **QRスキャン導線** | ワンタップでQRスキャン画面へ |
| **投稿・クーポン作成** | 新規投稿・クーポン作成へのショートカット（クーポン3枚上限時はボタン非活性） |
| **投稿セクション** | セクションタイトルは「投稿」で統一。Instagram投稿と通常投稿を日付降順で混合表示（最大10件）。投稿カードはタイトル非表示・テキスト2行表示 |
| **各管理画面への導線** | 投稿管理・クーポン管理・スタンプ履歴・お知らせ等への導線 |

### 2.3 QRスキャン・チェックイン

| 機能 | 説明 |
|------|------|
| **カメラQRスキャン** | ユーザーが提示したQRコードをカメラで読み取り |
| **サーバーサイド検証** | Cloud Functions `verifyQrToken` によるJWTトークンの検証（リトライ3回、指数バックオフ） |
| **検証結果判定** | OK / 期限切れ / 無効 / 使用済み のステータス判定 |
| **手動入力** | QRコードが読み取れない場合の手動入力フォールバック |

### 2.4 スタンプ・会計フロー

| 機能 | 説明 |
|------|------|
| **チェックイン確認** | QRスキャン後のユーザー情報と来店状況の事前確認 |
| **クーポン選択** | 会計時にユーザーが利用するクーポンの選択 |
| **会計案内** | レジでの会計促進画面 |
| **会計金額入力** | 会計金額の入力とユーザー情報の表示 |
| **適用特典計算** | クーポン適用後の会計情報を表示 |
| **承認待ち** | ユーザー側の承認を待つ画面（再送・会計導線付き） |
| **スタンプ押印確認** | 押印の承認/拒否操作と結果表示 |
| **スタンプ履歴** | 押印履歴の取引リストを表示 |
| **支払い処理** | 金額入力 → 決済方法選択 → スタンプ押印の一連フロー |

### 2.5 クーポン管理

| 機能 | 説明 |
|------|------|
| **クーポン一覧** | 店舗のクーポンをリスト表示 |
| **クーポン発行枚数制限** | 1店舗あたり最大3枚まで。上限到達時は作成ボタンを非活性化し制限メッセージを表示（クーポン管理画面・ホーム画面の両方で適用） |
| **クーポン作成** | タイトル、説明、タイプ（割引/無料/値引き）、割引値・割引タイプ、有効期間、発行枚数（無制限トグル対応）、必要スタンプ数、画像のアップロード |
| **クーポン編集** | 既存クーポンの情報変更（発行枚数の無制限トグル含む） |
| **カードタップ編集導線** | クーポン一覧カード全体のタップで編集画面へ遷移（一覧下部の編集ボタンは廃止） |
| **クーポン詳細** | クーポンの詳細情報と利用状況の確認 |
| **有効/無効切替** | クーポンのアクティブ状態のトグル |
| **クーポン削除** | 不要なクーポンの削除 |
| **使用統計** | 今日・月間・全体のクーポン使用数 |
| **店舗固定クーポン管理** | 店舗設定詳細から遷移した場合、対象店舗を固定してクーポン一覧/作成/編集/削除を実行 |
| **クーポン編集権限** | Firestoreルールで `isOwner` は全店舗、`isStoreOwner` は `createdStores` に含まれる店舗のみ管理可能（`coupons`/`public_coupons` 共通） |
| **public_couponsへの同期** | クーポンデータをユーザーアプリ側が参照するコレクションに自動同期 |

### 2.6 投稿管理

| 機能 | 説明 |
|------|------|
| **投稿管理一覧** | 店舗の投稿をリスト表示（編集・削除操作付き） |
| **投稿閲覧一覧** | 3列グリッドでInstagram投稿と通常投稿を混合表示（ホーム画面「全て見る」から遷移、最大51件・日付降順） |
| **投稿詳細閲覧** | 画像カルーセル、店舗アイコン+店舗名+投稿日付、いいね数/閲覧数（Instagram投稿・通常投稿の両方で表示）、コメント一覧（閲覧専用、Instagram投稿・通常投稿の両方で表示）、Instagram投稿時は「Instagramを開く」リンクボタン（元投稿に遷移） |
| **投稿作成** | 店舗選択、本文、画像の入力・アップロード（店舗ジャンルは店舗情報から自動取得） |
| **投稿編集** | 既存投稿の変更、画像の追加/削除 |
| **公開/下書き切替** | 投稿の公開状態の切替 |
| **投稿削除** | 不要な投稿の削除 |

### 2.7 ニュース管理

| 機能 | 説明 |
|------|------|
| **ニュース一覧** | ニュース記事のリスト表示（掲載中/掲載前/掲載終了のステータスバッジ付き） |
| **ニュース作成** | 画像選択（1:1比率）、タイトル/テキスト入力、掲載開始日/終了日の選択 |
| **ニュース編集** | 既存ニュース記事の変更 |
| **ニュース削除** | 不要なニュース記事の削除 |
| **掲載期間制御** | 開始日と終了日による自動的な公開/非公開の管理 |

### 2.8 分析・統計

| 機能 | 説明 |
|------|------|
| **分析ダッシュボード** | 月間スタンプ統計（押印数/10スタンプ達成数/特典利用数）、週間・月間統計カード、クーポン統計（発行クーポン一覧と各クーポンの合計使用者数）の表示 |
| **店舗利用者推移** | 日/週/月/年単位の利用者数推移グラフ（性別/年代フィルター対応） |
| **新規顧客推移** | 新規顧客数の推移グラフ |
| **クーポン利用者推移** | 全クーポン合算のクーポン利用数の推移グラフ |
| **個別クーポン利用推移** | 分析画面のクーポン統計セクションから各クーポンをタップして遷移する、個別クーポンの利用推移グラフ |
| **おすすめ表示推移** | デイリーレコメンドの表示数・クリック数の推移グラフ（2グラフ構成） |
| **全ユーザー推移** | 全ユーザー数（累積）の推移グラフ（管理者オーナー専用） |
| **全ユーザーログイン数推移** | 日別のログインユーザー数の推移グラフ（管理者オーナー専用、`daily_login_stats` コレクション参照） |
| **スタンプ押印推移** | スタンプ押印数の推移グラフ |
| **スタンプ獲得ユーザー推移** | スタンプ獲得ユーザー数の推移グラフ |
| **全スタンプ押印数推移** | 全店舗の総スタンプ押印数推移（管理者オーナー専用） |
| **週間統計** | 新規来店者数 / 週間来店者数 / リピート率 |
| **月間統計** | 新規来店者数 / 月間来店者数 / リピート率 |
| **送客KPI** | 送客起点初回来店数 / 送客起点初回来店率 / 送客バランス（直近30日間） |
| **送客ランキング** | 送客元店舗TOP5 / 送客先店舗TOP5 |

### 2.9 ユーザー管理

| 機能 | 説明 |
|------|------|
| **店舗ユーザー詳細** | 来店したユーザーの統計情報（来店回数/スタンプ数/クーポン利用数） |
| **今日の来店者一覧** | 本日来店したユーザーのリスト（来店時間・獲得スタンプ付き） |
| **ユーザー属性のデノーマライズ** | トランザクションに性別・年代のデータを自動保存（分析用） |

### 2.10 ランキング

| 機能 | 説明 |
|------|------|
| **ランキング表示** | ユーザーランキングの確認 |
| **ソート種別** | コイン数 / バッジ数 / レベル / スタンプ数 / 支払い額 |
| **期間フィルター** | 日次 / 週次 / 月次 / 全期間 |

### 2.11 通知・お知らせ管理

| 機能 | 説明 |
|------|------|
| **通知一覧** | 受信した通知の確認、既読/未読管理、全既読、削除 |
| **通知詳細** | 通知の種別バッジ、本文、タグ/画像の詳細表示 |
| **お知らせ管理** | お知らせの一覧管理、作成/編集/削除/公開切替（管理者オーナー向け） |
| **お知らせ作成** | タイトル、本文、カテゴリ、優先度、タグ、予約投稿の設定 |
| **お知らせ編集** | 既存お知らせの変更 |
| **お知らせ詳細** | 閲覧数・既読数の統計付き詳細表示 |
| **通知設定（統合）** | プッシュ通知（新規来店者/クーポン使用/フィードバック）・メール通知（システム/プロモーション）の項目ごとのON/OFF切替を1画面で管理。トグル切替時にFirestore即時保存（stores/{storeId}） |
| **プッシュ通知** | FCMトークンの管理とフォアグラウンド/バックグラウンド通知 |

### 2.12 店舗設定

| 機能 | 説明 |
|------|------|
| **店舗プロフィール編集** | 店舗名、カテゴリ、住所、説明、営業時間、経営形態/法人名、SNSリンク、アイコン画像・店舗画像の編集 |
| **店舗位置情報編集** | マップ上で店舗の所在地を変更 |
| **メニュー管理** | メニューの追加/編集/削除、カテゴリ別フィルタ（コース/料理/ドリンク/デザート）、ドラッグ&ドロップでの並び替え |
| **メニュー作成** | 画像選択、カテゴリ選択、メニュー名/説明/価格の入力 |
| **店内画像管理** | 店舗の内装写真の追加/削除/並び替え（Firebase Storageへのアップロード） |
| **決済方法設定** | 対応する決済手段の選択（4カテゴリ・30種以上の決済方法） |
| **座席数設定** | カウンター/テーブル/座敷/テラス/個室/ソファーの座席情報 |
| **設備・サービス情報** | 駐車場/アクセス/テイクアウト/喫煙/Wi-Fi/バリアフリー/子連れ/ペットの設定 |
| **Instagram連携** | OAuth手順案内、認証コード入力、同期/解除、同期完了確認 |
| **店舗アイコントリミング** | アイコン画像の丸型クロップ処理 |

### 2.13 決済方法の詳細

| カテゴリ | 対応決済方法 |
|---------|------------|
| **現金** | 現金 |
| **クレジット/デビット/プリペイド** | Visa / Mastercard / JCB / American Express / Diners Club / Discover / UnionPay / デビットカード / プリペイドカード / タッチ決済 / Apple Pay / Google Pay |
| **電子マネー** | 交通系IC（Suica/PASMO等）/ iD / QUICPay / 楽天Edy / nanaco / WAON |
| **QR/バーコード決済** | PayPay / d払い / 楽天ペイ / au PAY / メルペイ / WeChat Pay / Alipay+ / UnionPay QR / COIN+ / J-Coin Pay / Smart Code / Bank Pay / ゆうちょPay |

### 2.14 店舗運用管理

| 機能 | 説明 |
|------|------|
| **店舗切替** | 複数店舗を持つオーナーの管理対象店舗の切替 |
| **店舗稼働設定** | 店舗の公開/非公開（稼働ON/OFF）の切替 |
| **店舗設定詳細** | プロフィール/位置情報/メニュー/店内画像/決済方法/クーポン管理の各編集画面への導線 |
| **ポスター用プロンプトコピー** | 店舗名・住所・電話番号・説明・営業時間・クーポン情報をマークダウン形式でクリップボードにコピー |
| **ポスター用画像一括ダウンロード** | 店舗イメージ画像と全クーポン画像をZIP化してダウンロード（Web/モバイル両対応） |

### 2.15 フィードバック管理

| 機能 | 説明 |
|------|------|
| **フィードバック送信** | 運営へのフィードバック送信（件名、メッセージ、カテゴリ） |
| **フィードバック管理** | ステータス集計付きのフィードバック一覧（管理者オーナー向け） |
| **フィードバック詳細** | 詳細内容の表示、ステータス更新（pending / reviewed / resolved）、削除 |

### 2.16 サポート・法務

| 機能 | 説明 |
|------|------|
| **ヘルプ・サポート** | FAQ、問い合わせ導線、アプリ情報 |
| **メールサポート** | 問い合わせフォーム |
| **電話サポート** | 電話番号、営業時間、対応内容 |
| **ライブチャット** | ユーザー一覧（未読バッジ付き）+ リアルタイムチャット画面 |
| **アプリ情報** | バージョン情報、開発者情報、法的リンク |
| **プライバシーポリシー** | ポリシー本文の表示 |
| **利用規約** | 規約本文の表示 |
| **セキュリティポリシー** | セキュリティポリシーの表示 |

### 2.17 プラン・契約

| 機能 | 説明 |
|------|------|
| **プラン契約情報** | 現在のプラン、プラン一覧、契約情報の確認（当面はベーシックのみ提供し、プレミアムは加盟店約30店舗到達後に導入予定） |

---

## 3. 管理者オーナー専用機能

管理者オーナー（`isOwner = true`）のみが利用できる高度な管理機能です。

### 3.1 プラットフォーム管理

| 機能 | 説明 |
|------|------|
| **店舗審査** | 未承認店舗の一覧表示、承認/却下の操作 |
| **全ユーザー推移** | プラットフォーム全体のユーザー数推移グラフ |
| **全ユーザーログイン数推移** | 日別のログインユーザー数推移グラフ |
| **全スタンプ押印数推移** | 全店舗横断のスタンプ押印数推移 |

### 3.2 オーナー設定

| 機能 | 説明 |
|------|------|
| **友達キャンペーン設定（停止中）** | 友達紹介を当面実施しないため利用停止 |
| **店舗キャンペーン設定（検討中）** | 店舗紹介導入時に有効化予定 |
| **スロットキャンペーン設定** | スロットキャンペーンの開始日・終了日の設定 |
| **基本ポイント還元率（廃止済み）** | ポイント制度廃止に伴い利用停止 |
| **レベル別還元率（廃止済み）** | ポイント制度廃止に伴い利用停止 |
| **メンテナンスモード** | メンテナンス開始/終了日時の設定 |
| **アプリバージョン管理** | 最低バージョン/最新バージョン/ストアURLの設定（店舗用/ユーザー用の両方） |

### 3.3 コンテンツ管理

| 機能 | 説明 |
|------|------|
| **お知らせ管理** | プラットフォーム全体のお知らせの作成/編集/削除/公開管理 |
| **フィードバック管理** | ユーザーからのフィードバックのステータス管理 |
| **ライブチャット管理** | 全ユーザーとのチャット一覧・応対 |
| **アカウント削除申請管理** | 店舗オーナーからの退会申請一覧の確認、承認（店舗無効化）/拒否の操作 |

---

---

## 5. 技術基盤

### 5.1 バックエンド（Firebase）

| サービス | 用途 |
|---------|------|
| **Firebase Auth** | ユーザー認証（Google/Apple/メール/匿名） |
| **Cloud Firestore** | データベース（店舗/ユーザー/トランザクション/クーポン等） |
| **Firebase Storage** | 画像のアップロード・保存（圧縮処理付き） |
| **Cloud Functions** | QRトークン検証、メールOTP送信/検証、レート計算 |
| **Firebase Cloud Messaging** | プッシュ通知の配信 |

### 5.2 主要なCloud Functions

| 関数名 | 機能 |
|--------|------|
| `verifyQrToken` | QRトークンのサーバーサイドJWT検証 |
| `requestEmailOtp` | メール認証用OTPの送信 |
| `verifyEmailOtp` | メール認証用OTPの検証 |

### 5.3 データモデル概要

| モデル | 主な用途 |
|--------|---------|
| **StoreModel** | 店舗情報（名前/住所/位置/カテゴリ/営業時間/画像/プラン等） |
| **UserPointBalance（旧）** | 旧ポイント残高モデル（ポイント制度廃止に伴い新規利用停止） |
| **PointTransactionModel（旧）** | 旧ポイント取引モデル（ポイント制度廃止に伴い新規利用停止） |
| **Coupon / UserCoupon** | クーポン定義とユーザーのクーポン取得/使用状況 |
| **BadgeModel / UserBadgeModel** | バッジ定義とユーザーのバッジ取得状況 |
| **NotificationModel** | 通知データ（種別/既読/配信状態/タグ） |
| **RankingModel** | ランキング情報（コイン/バッジ/スタンプ/順位変動） |
| **MapFilterModel** | マップフィルター設定 |
| **NewsModel** | ニュース記事（掲載期間制御付き） |
| **PointRequest（旧）** | 旧ポイント付与リクエスト（ポイント制度廃止に伴い新規利用停止） |
| **QRToken / QRVerificationModel** | QRトークンの生成・検証 |
| **OwnerSettings** | プラットフォーム設定（キャンペーン/メンテナンス/バージョン） |
| **FeedbackModel** | フィードバック（ステータス管理付き） |
| **SocialModel** | ソーシャル機能（プロフィール/フォロー/投稿/コメント/いいね） |

---
